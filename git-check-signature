#!/usr/bin/env bash

set -e
set -u

sign-key() {
	# Get signature key
	git log --show-signature -1 | rg -o 'RSA key (\w+)' -r '$1'
}

verify-sig() {
	# Verify commit has valid signature.
    echo heleo
	git verify-commit HEAD > /dev/null && ok "OK valid signature on HEAD" || error "ERROR no signature on HEAD" 

}

verify-matching-sig() {

    # Verify if sigature key for commit matches the one provided
	[[ "$(sign-key)" == "$1" ]] &&
		ok "OK signatures matches '$(sign-key)' == '${1}'" ||
		error "ERROR signature does not match. '$(sign-key)' != '${1}'"
}

error() {
	echo "$@"; exit 0
}
ok() {
	echo "$@"; exit 0
	exit 0
}

verify-sig

#verify-matching-sig "$1"
